"use strict";(self.webpackChunk_jupyter_collaboration_extension=self.webpackChunk_jupyter_collaboration_extension||[]).push([[9],{6009:(e,t,r)=>{r.r(t),r.d(t,{CollaboratorsBody:()=>M,CollaboratorsPanel:()=>A,IGlobalAwareness:()=>n,IUserMenu:()=>s,RendererUserMenu:()=>w,UserInfoBody:()=>P,UserInfoPanel:()=>C,UserMenu:()=>I,remoteUserCursors:()=>v});var o=r(7930);const s=new o.Token("@jupyter/collaboration:IUserMenu"),n=new o.Token("@jupyter/collaboration:IGlobalAwareness");var a=r(8204),i=r(9502),l=r(981);const c=a.Facet.define({combine:e=>e[e.length-1]}),d=i.EditorView.baseTheme({".jp-remote-cursor":{borderLeft:"1px solid black",marginLeft:"-1px"},".jp-remote-cursor.jp-mod-primary":{borderLeftWidth:"2px"},".jp-remote-selection":{opacity:.5},".cm-tooltip":{border:"none"},".cm-tooltip .jp-remote-userInfo":{color:"var(--jp-ui-inverse-font-color0)",padding:"0px 2px"}}),u=a.Annotation.define();class h{constructor(e,t){this.style=e,this.marker=t}draw(){const e=this.marker.draw();for(const[t,r]of Object.entries(this.style))e.style[t]=r;return e}eq(e){return this.marker.eq(e.marker)&&o.JSONExt.deepEqual(this.style,e.style)}update(e,t){for(const[t,r]of Object.entries(this.style))e.style[t]=r;return this.marker.update(e,t.marker)}}const p=(0,i.layer)({above:!0,markers(e){const{awareness:t,ytext:r}=e.state.facet(c),o=r.doc,s=[];return t.getStates().forEach(((n,c)=>{var d,u,p;if(c===t.doc.clientID)return;const m=n.cursors;for(const t of null!=m?m:[]){if(!(null==t?void 0:t.anchor)||!(null==t?void 0:t.head))return;const c=(0,l.createAbsolutePositionFromRelativePosition)(t.anchor,o),m=(0,l.createAbsolutePositionFromRelativePosition)(t.head,o);if((null==c?void 0:c.type)!==r||(null==m?void 0:m.type)!==r)return;const f=null===(d=t.primary)||void 0===d||d?"jp-remote-cursor jp-mod-primary":"jp-remote-cursor",y=a.EditorSelection.cursor(m.index,m.index>c.index?-1:1);for(const t of i.RectangleMarker.forRange(e,f,y))s.push(new h({borderLeftColor:null!==(p=null===(u=n.user)||void 0===u?void 0:u.color)&&void 0!==p?p:"black"},t))}})),s},update:(e,t)=>!!e.transactions.find((e=>e.annotation(u))),class:"jp-remote-cursors"}),m=(0,i.hoverTooltip)(((e,t)=>{var r;const{awareness:o,ytext:s}=e.state.facet(c),n=s.doc;for(const[e,a]of o.getStates())if(e!==o.doc.clientID)for(const e of null!==(r=a.cursors)&&void 0!==r?r:[]){if(!(null==e?void 0:e.head))continue;const r=(0,l.createAbsolutePositionFromRelativePosition)(e.head,n);if((null==r?void 0:r.type)===s&&r.index-1<=t&&t<=r.index+1)return{pos:r.index,above:!0,create:()=>{var e,t,r,o;const s=document.createElement("div");return s.classList.add("jp-remote-userInfo"),s.style.backgroundColor=null!==(t=null===(e=a.user)||void 0===e?void 0:e.color)&&void 0!==t?t:"darkgrey",s.textContent=null!==(o=null===(r=a.user)||void 0===r?void 0:r.display_name)&&void 0!==o?o:"Anonymous",{dom:s}}}}return null}),{hideOn:(e,t)=>!!e.annotation(u)}),f=(0,i.layer)({above:!1,markers(e){const{awareness:t,ytext:r}=e.state.facet(c),o=r.doc,s=[];return t.getStates().forEach(((n,c)=>{var d,u,p;if(c===t.doc.clientID)return;const m=n.cursors;for(const t of null!=m?m:[]){if(null===(d=t.empty)||void 0===d||d||!(null==t?void 0:t.anchor)||!(null==t?void 0:t.head))return;const c=(0,l.createAbsolutePositionFromRelativePosition)(t.anchor,o),m=(0,l.createAbsolutePositionFromRelativePosition)(t.head,o);if((null==c?void 0:c.type)!==r||(null==m?void 0:m.type)!==r)return;const f="jp-remote-selection";for(const t of i.RectangleMarker.forRange(e,f,a.EditorSelection.range(c.index,m.index)))s.push(new h({backgroundColor:null!==(p=null===(u=n.user)||void 0===u?void 0:u.color)&&void 0!==p?p:"black"},t))}})),s},update:(e,t)=>!!e.transactions.find((e=>e.annotation(u))),class:"jp-remote-selections"}),y=i.ViewPlugin.fromClass(class{constructor(e){this.editorAwareness=e.state.facet(c),this._listener=({added:t,updated:r,removed:o})=>{t.concat(r).concat(o).findIndex((e=>e!==this.editorAwareness.awareness.doc.clientID))>=0&&e.dispatch({annotations:[u.of([])]})},this.editorAwareness.awareness.on("change",this._listener)}destroy(){this.editorAwareness.awareness.off("change",this._listener)}update(e){var t;if(!e.docChanged&&!e.selectionSet)return;const{awareness:r,ytext:s}=this.editorAwareness,n=r.getLocalState();if(n){const a=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),i=e.state.selection,c=new Array;if(a&&i){for(const e of i.ranges){const t=e===i.main,r=(0,l.createRelativePositionFromTypeIndex)(s,e.anchor),o=(0,l.createRelativePositionFromTypeIndex)(s,e.head);c.push({anchor:r,head:o,primary:t,empty:e.empty})}if(!n.cursors||c.length>0){const e=null===(t=n.cursors)||void 0===t?void 0:t.map((e=>({...e,anchor:(null==e?void 0:e.anchor)?(0,l.createRelativePositionFromJSON)(e.anchor):null,head:(null==e?void 0:e.head)?(0,l.createRelativePositionFromJSON)(e.head):null})));o.JSONExt.deepEqual(c,e)||r.setLocalStateField("cursors",c)}}}}},{provide:()=>[d,p,f,m,(0,i.tooltips)({position:"absolute",parent:document.body})]});function v(e){return[c.of(e),y]}var b=r(9190),_=r(8778),g=r(4059);class w extends _.MenuBar.Renderer{constructor(e){super(),this._user=e}renderItem(e){const t=this.createItemClass(e),r=this.createItemDataset(e),o=this.createItemARIA(e);return g.h.li({className:t,dataset:r,tabindex:"0",onfocus:e.onfocus,...o},this._createUserIcon(),this.renderLabel(e),this.renderIcon(e))}renderLabel(e){const t=this.formatLabel(e);return g.h.div({className:"lm-MenuBar-itemLabel jp-MenuBar-label"},t)}_createUserIcon(){return this._user.isReady&&this._user.identity.avatar_url?g.h.div({className:"lm-MenuBar-itemIcon jp-MenuBar-imageIcon"},g.h.img({src:this._user.identity.avatar_url})):this._user.isReady?g.h.div({className:"lm-MenuBar-itemIcon jp-MenuBar-anonymousIcon",style:{backgroundColor:this._user.identity.color}},g.h.span({},this._user.identity.initials)):g.h.div({className:"lm-MenuBar-itemIcon jp-MenuBar-anonymousIcon"},b.userIcon)}}class I extends _.Menu{constructor(e){super(e)}}var x=r(60),j=r(6029);const k=e=>{const{user:t}=e;return j.createElement("div",{className:"jp-UserInfo-Container"},j.createElement("div",{title:t.display_name,className:"jp-UserInfo-Icon",style:{backgroundColor:t.color}},j.createElement("span",null,t.initials)),j.createElement("h3",null,t.display_name))};class C extends _.Panel{constructor(e){super({}),this.addClass("jp-UserInfoPanel"),this._profile=e,this._body=null,this._profile.isReady?(this._body=new P(this._profile.identity),this.addWidget(this._body),this.update()):this._profile.ready.then((()=>{this._body=new P(this._profile.identity),this.addWidget(this._body),this.update()})).catch((e=>console.error(e)))}}class P extends x.ReactWidget{constructor(e){super(),this._user=e}get user(){return this._user}set user(e){this._user=e,this.update()}render(){return j.createElement(k,{user:this._user})}}var R=r(4989);const E="jp-Collaborator";class A extends _.Panel{constructor(e,t,r){super({}),this._onAwarenessChanged=()=>{const e=this._awareness.getStates(),t=[];e.forEach(((e,r)=>{this._currentUser.isReady&&e.user.name!==this._currentUser.identity.name&&t.push(e)})),this._body.collaborators=t},this._awareness=t,this._currentUser=e,this.addClass("jp-CollaboratorsPanel"),this._body=new M(r),this.addWidget(this._body),this.update(),this._awareness.on("change",this._onAwarenessChanged)}}class M extends x.ReactWidget{constructor(e){super(),this._collaborators=[],this._fileopener=e,this.addClass("jp-CollaboratorsList")}get collaborators(){return this._collaborators}set collaborators(e){this._collaborators=e,this.update()}render(){return this._collaborators.map(((e,t)=>{let r=!1,o="",s="",n="";if(e.current){r=!0;const t=e.current.split(":");n=`${t[1]}:${t[2]}`,o=R.PathExt.basename(t[2]),o=o.length>25?o.slice(0,12).concat("…"):o,s="•"}const a=`${e.user.display_name} ${s} ${o}`;return j.createElement("div",{className:r?`jp-ClickableCollaborator ${E}`:E,key:t,onClick:()=>{r&&this._fileopener(n)}},j.createElement("div",{className:"jp-CollaboratorIcon",style:{backgroundColor:e.user.color}},j.createElement("span",null,e.user.initials)),j.createElement("span",null,a))}))}}}}]);