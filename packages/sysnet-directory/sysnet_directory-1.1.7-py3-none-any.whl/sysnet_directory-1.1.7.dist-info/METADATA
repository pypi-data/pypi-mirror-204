Metadata-Version: 2.1
Name: sysnet-directory
Version: 1.1.7
Summary: Directory client library
Author-email: Data Developer <info@sysnet.cz>
License: # LICENCE PRO DOMÁCÍ POUŽITÍ (SYSNET Home Use License) v 1.0
        
        ## SHUL © SYSNET s.r.o. 2022
        
        <h4 style="text-align: center;">Tato komerční licence SYSNET s.r.o. se vztahuje na dílo (ve smyslu níže uvedených
        definic), které se poskytuje podle podmínek této licence. Použití díla v rozporu s touto licencí je zakázáno (v míře, v
        jaké se na uvedené použití vztahuje právo držitele autorských práv k dílu).
        Dílo se poskytuje podle podmínek této licence, pokud poskytovatel licence (ve smyslu níže uvedených definic)
        bezprostředně za doložku o autorských právech k dílu umístil toto upozornění:
        Na toto dílo se vztahuje licence SHUL
        nebo jakýmkoli jiným způsobem vyjádřil úmysl, aby se dílo poskytovalo podle licence SHUL. </h4>
        
        ## 1. Definice
        
        V rámci této licence mají následující výrazy tento význam:
        
        * „Licencí“ se rozumí tato licence.
        * „Původním dílem“ se rozumí dílo nebo software šířené nebo sdělené poskytovatelem licence podle této licence, dostupné
          jako zdrojový kód anebo též jako spustitelný kód.
        * „Odvozenými díly“ se rozumí díla nebo software, které by nabyvatel licence mohl vytvořit na základě původního díla
          nebo jeho úprav. V této licenci není definováno, jaká musí být míra úprav nebo závislosti na původním díle, aby bylo
          považováno za odvozené dílo; tuto míru určuje autorské právo použitelné v zemi podle článku 15.
        * „Dílem“ se rozumí původní dílo nebo díla z něj odvozená.
        * „Zdrojovým kódem“ se rozumí podoba díla čitelná pro člověka, kterou mohou lidé nejpohodlněji analyzovat a upravovat.
        * „Spustitelným kódem“ se rozumí takový kód, který byl obecně sestaven a jenž má být interpretován počítačem jako
          program.
        * „Poskytovatelem licence“ se rozumí fyzická nebo právnická osoba, která dílo podle licence šíří nebo sděluje.
        * „Přispěvatelem“ se rozumí fyzická nebo právnická osoba, jež dílo podle licence upraví nebo jinak přispěje k vytvoření
          odvozeného díla.
        * „Nabyvatelem licence“ nebo „Vámi“ se rozumí fyzická nebo právnická osoba, která používá dílo podle podmínek licence.
        * „Šířením“ nebo „sdělováním“ se rozumí prodej, předání, zapůjčení, pronájem, šíření, sdělování, přenos nebo jiný způsob
          zpřístupnění kopií díla nebo zpřístupnění jeho podstatných funkcí jakékoli fyzické nebo právnické osobě, a to online
          nebo offline.
        
        ## 2. Rozsah práv udělených licencí
        
        Poskytovatel licence Vám tímto po dobu trvání autorských práv k původnímu dílu udílí celosvětovou, bezúplatnou,
        nevýhradní licenci bez možnosti poskytování podlicence, k těmto činnostem:
        
        * používání díla pro soukromé domácí účely a pro nekomerční použití,
        * rozmnožování díla v rámci domácnosti,
        * úpravě díla a vytvoření odvozených děl na základě díla v rámci domácnosti a pro nekomerční použití,
        
        Uvedená práva lze uplatnit na všechna média, nosiče a formáty, které jsou v současnosti známé nebo budou v budoucnu
        vynalezeny, do té míry, do jaké to připouští rozhodné právo.
        V zemích, kde se uplatňují osobnostní práva, se poskytovatel licence vzdává práva vykonávat své osobnostní právo v
        rozsahu, v jakém to rozhodné právo umožňuje, aby tak byl umožněn účinný výkon majetkových práv výše uvedených.
        Poskytovatel licence v míře nezbytné k využívání práv udělených k dílu podle této licence udílí nabyvateli licence
        bezúplatná, nevýlučná práva na využití případných patentů náležejících poskytovateli licence.
        
        ## 3. Sdělování zdrojového kódu
        
        Poskytovatel licence může poskytnout dílo buď v podobě zdrojového kódu, nebo jako spustitelný kód. Pokud se dílo
        poskytuje v podobě spustitelného kódu, poskytovatel licence navíc společně s každou kopií díla, kterou šíří nebo na ni
        odkazuje, poskytne strojově čitelné vyhotovení zdrojového kódu díla; může též v závěru doložky o autorských plánech
        odkázat na umístění, kde se po dobu, kdy poskytovatel licence šíří nebo sděluje dílo, nachází snadno a volně dostupný
        zdrojový kód.
        
        ## 4. Omezení autorských práv
        
        Žádným ustanovením této licence nemůže být nabyvatel licence zbaven výhod z případných výjimek z výlučných práv majitelů
        práv k dílu nebo případného omezení těchto výlučných práv, nebo z vyčerpání uvedených práv nebo z jiných relevantních
        omezení vztahujících se k takovým právům.
        
        ## 5. Závazky nabyvatele licence
        
        Udělení uvedených práv podléhá určitým omezením a závazkům vůči nabyvateli licence. Jedná se o tyto závazky:
        
        * **Právo na označení**: Nabyvatel licence zachová beze změny veškerá oznámení týkající se autorských práv, patentů či
          ochranných známek a veškerá oznámení odkazující na licenci a na vyloučení záruk. Kopii takových oznámení a kopii
          licence musí nabyvatel licence připojit ke každé kopii díla, kterou šíří nebo sděluje. Nabyvatel licence musí
          zajistit, aby odvozené dílo bylo opatřeno výrazným oznámením, že původní dílo bylo upraveno, a též datem úpravy.
        
        * **Ustanovení o nezměnitelnosti podmínek** (tzv. copyleft clause): Pokud nabyvatel licence šíří nebo sděluje kopie
          původních děl nebo odvozených děl, uvedené šíření nebo sdělování bude probíhat podle podmínek této licence nebo podle
          pozdější verze této licence, není-li původní dílo výslovně šířeno pouze pod touto verzí licence – např. označením
          „výlučně SHUL v. 1.0“. Nabyvatel licence (který se stává poskytovatelem licence) nemůže v souvislosti s dílem nebo
          odvozeným dílem nabízet nebo ukládat žádné dodatečné podmínky, které by měnily nebo omezovaly podmínky licence.
        
        * **Poskytování zdrojového kódu**: Při šíření nebo sdělování kopií díla nabyvatel licence poskytne strojově čitelné
          znění zdrojového kódu nebo odkáže na umístění, kde po dobu, kdy nabyvatel licence pokračuje v šíření nebo sdělování
          díla, je uvedený zdrojový kód snadno a volně přístupný.
        
        * **Právní ochrana**: Touto licencí se nepovoluje použít obchodní názvy, ochranné známky pro výrobky a služby nebo názvy
          poskytovatele licence, s výjimkou případů, kdy tento požadavek vzniká s ohledem na přiměřené a obvyklé použití při
          popisu původu díla a při reprodukci obsahu doložky o autorských právech.
        
        ## 6. Řetězec autorství
        
        Původní poskytovatel licence prohlašuje, že je majitelem autorských práv k původnímu dílu, jež jsou předmětem této
        licence, nebo že mu k nim byla udělena licence a že má pravomoc a oprávnění licenci udělit.
        Každý přispěvatel prohlašuje, že je majitelem autorských práv k úpravám, kterými dílo mění, nebo že mu k nim byla
        udělena licence a že má pravomoc a oprávnění licenci udělit.
        Kdykoli přijmete licenci, původní poskytovatel licence a následní přispěvatelé Vám udílejí licenci ke svým příspěvkům k
        dílu podle podmínek této licence.
        
        ## 7. Vyloučení záruky
        
        Dílo se chápe jako dílo, které se stále vyvíjí a které četní přispěvatelé průběžně zdokonalují. Nejedná se o hotové
        dílo, a může proto obsahovat vady či chyby v programu, které se při takovémto způsobu vývoje běžně vyskytují. Z
        uvedeného důvodu se dílo podle licence poskytuje v podobě tak, jak je, a bez jakýchkoli záruk k dílu, včetně, mimo jiné,
        obchodovatelnosti, vhodnosti pro konkrétní účel, bezchybnosti a nechybovosti, přesnosti, neporušení práv duševního
        vlastnictví vyjma práva autorského, jak je uvedeno v článku 6 této licence. Toto odmítnutí záruky je nedílnou součástí
        licence a podmínkou pro udělení jakýchkoli práv k dílu.
        
        ## 8. Vyloučení odpovědnosti
        
        S výjimkou případů úmyslného pochybení nebo škod přímo způsobených fyzickým osobám nenese poskytovatel licence v žádném
        případě odpovědnost za jakékoli přímé nebo nepřímé škody, hmotnou nebo mravní újmu či jakékoli jiné škody vyplývající z
        licence nebo použití díla, včetně škod způsobených ztrátou dobré pověsti, přerušením práce, poruchou nebo nesprávným
        fungováním počítače, ztrátou dat nebo jakýchkoli škod komerční povahy, a to i tehdy, pokud poskytovatel licence byl na
        možnost takové škody upozorněn. Poskytovatel licence však ponese odpovědnost podle zákonů týkajících se odpovědnosti za
        škodu způsobenou vadou výrobku v míře, v jaké se takové zákony na dané dílo vztahují.
        
        ## 9. Dodatečné dohody
        
        Při rozšiřování díla se můžete rozhodnout uzavřít dodatečné dohody, v nichž se vymezí povinnosti nebo služby v souladu s
        touto licencí. Pokud však na sebe vezmete závazky, můžete jednat pouze vlastním jménem a výhradně na vlastní
        odpovědnost, nikoli jménem původního poskytovatele licence či jakéhokoli dalšího přispěvatele, a pouze pokud souhlasíte
        s tím, že každého přispěvatele odškodníte, budete hájit a uchráníte před škodou nebo uplatňovanými nároky, pokud jde o
        jakoukoli odpovědnost vzniklou uvedenému přispěvateli v důsledku skutečnosti, že jste přijali záruku nebo dodatečnou
        odpovědnost.
        
        ## 10. Přijetí licence
        
        S ustanoveními této licence lze vyjádřit souhlas kliknutím na ikonu „Souhlasím“ („I agree“) umístěnou pod oknem, kde je
        zobrazeno znění této licence, nebo vyjádřením souhlasu obdobným způsobem podle rozhodného práva. Kliknutím na uvedenou
        ikonu vyjadřujete zřejmý a neodvolatelný souhlas s touto licencí a veškerými jejími podmínkami.
        Obdobně tuto licenci a veškeré její podmínky neodvolatelně přijímáte, pokud vykonáváte práva, která jsou Vám poskytnuta
        v souladu s článkem 2 této licence, např. pokud dílo užíváte, vytváříte odvozené dílo nebo dílo nebo jeho kopie šíříte
        nebo sdělujete.
        
        ## 11. Informování veřejnosti
        
        Pokud dílo šíříte nebo sdělujete prostřednictvím elektronické komunikace (např. nabízíte stažení díla ze vzdáleného
        umístění), musí příslušný distribuční kanál nebo média (např. internetové stránky) uvádět alespoň takové informace
        určené veřejnosti, které jsou požadovány rozhodným právem ohledně poskytovatele licence, licence samotné a způsobu
        jejího zpřístupnění, uzavření, uchovávání a reprodukování nabyvatelem licence.
        
        ## 12. Zánik licence
        
        Platnost licence a práv touto licencí udělených bez dalšího zaniká, pokud nabyvatel licence poruší jakýmkoli způsobem
        podmínky licence. Uvedeným zánikem není ukončena licence jakékoli osoby, která podle licence dílo obdržela od nabyvatele
        licence, za podmínky, že takové osoby nadále plně jednají v souladu s podmínkami licence.
        
        ## 13. Různé
        
        Aniž je dotčen výše uvedený článek 9, představuje licence úplnou dohodu mezi stranami, pokud jde o dílo. Je-li podle
        rozhodného práva jakékoli ustanovení této licence neplatné nebo nevymahatelné, neovlivní tato skutečnost platnost nebo
        vymahatelnost licence jako celku. Takové ustanovení se vyloží nebo podle potřeby upraví tak, aby bylo platné a
        vymahatelné. Evropská komise může v požadované a přiměřené míře zveřejnit další jazykové verze nebo nové verze této
        licence nebo aktualizované verze dodatku, aniž by omezila rozsah práv udělených licencí. Novým verzím bude při
        zveřejnění přiděleno jedinečné číslo verze. Všechny jazykové verze této licence schválené Evropskou komisí mají stejnou
        platnost. Strany mohou využít jazykové verze dle svého výběru.
        
        ## 14. Soudní příslušnost
        
        Aniž jsou dotčeny zvláštní dohody mezi stranami,
        
        * soudní spor, který by popřípadě vyplynul z výkladu této licence mezi stranami, se bude řídit výlučnou pravomocí
          příslušného soudu, kde má poskytovatel licence bydliště nebo vykonává hlavní obchodní činnost.
        
        ## 15. Rozhodné právo
        
        Aniž jsou dotčeny zvláštní dohody mezi stranami,
        
        * tato licence se řídí právem České republiky
        
Project-URL: Homepage, https://github.com/SYSNET-CZ/esmlouvy/tree/main/directory
Classifier: Development Status :: 5 - Production/Stable
Classifier: Programming Language :: Python :: 3
Classifier: License :: Free For Home Use
Classifier: Operating System :: OS Independent
Classifier: Topic :: System :: Systems Administration :: Authentication/Directory :: LDAP
Requires-Python: >=3.9
Description-Content-Type: text/markdown
License-File: LICENSE.md

# sysnet-directory

Tento balíček obsahuje procedury pro prohledávání osob a skupin na serveru LDAP (AD) 
a extrakci údajů organizační struktury ze získaných hodnot.
Je určen primárně pro projekt eSMLOUVY MŽP.

## Požadavky

Python 3.9+

## Instalace a použití
### pip install sysnet-directory

(pokud potřebujete ke spuštění  `pip` with oprávnění rool: `sudo pip install sysnet-directory`)

Pak importujte balíček:

```python
import sysnet_directory
```

### Setuptools

Instalace via [Setuptools](http://pypi.python.org/pypi/setuptools).

```sh
python setup.py install --user sysnet-sysnet_directory
```
(nebo `sudo python setup.py install sysnet-directory` pro instalaci balíčku pro všechny uživatele)

A import balíčku:

```python
import sysnet_directory
```

## Použití v programu

Balíček poskytuje singleton `DIRECTORY_FACTORY`, který obsahuje veškerou funkcionalitu.
Implicitně je singleton ve stavu **disabled**. Jeho použití lze povolit pomocí příkazu **reset**.

    DIRECTORY_FACTORY.reset(..., enabled=True)

### Vyhledání osoby

#### Klíčové slovo 

KLíčovým slovem pro hledání osoby může být jméno, adresa elektronické pošty, osobní číslo nebo název funkce 
(to vše včetně zástupných znaků). Vrací seznam (list) slovníků (dictinary).

    from sysnet_directory.factory import DIRECTORY_FACTORY
    ...
    user_list = DIRECTORY_FACTORY.get_user('Jos*')
    user_list = DIRECTORY_FACTORY.get_all_users()

Pro případ potřeby lze tuto funkci zavolat jako "raw". Pak vrací surovou odpověď LDAP serveru. 
    
    user_list = DIRECTORY_FACTORY.get_user_raw('Jos*')

#### Mapa uživatelů
Pro účely snadného mapování osobních čísel na uživatele je tu funkce **get_user_map**. Vrací slovník (dictionary) 
obsahující jako klíč osobní číslo uživatele a v kodnotě je slovník s daty uživatele.

    from sysnet_directory.factory import DIRECTORY_FACTORY
    ...
    user_map = DIRECTORY_FACTORY.get_user_map()


#### Organizační jednotka

Osoby lze vyhledávat rovněž podle kódu organizační jednotky:

    user_list = DIRECTORY_FACTORY.get_user(ou='210')

vrací všechny osoby z organizační jednotky 210.

#### Vedoucí funkce

Lze vyhledávat osoby podle vedoucí funkce:

    user_list = DIRECTORY_FACTORY.get_user(head=True)

Vrátí všechny vedoucí v organizaci

    user_list = DIRECTORY_FACTORY.get_user(ou='210', head=True)

Vrátí vedoucí v organizační jednotce 210

#### Informace o zařazení do organizační struktury

Vrácený slovník pro uživatele obsahuje kromě identifikačních a popisných údajů tyto struktury:

1. **division** - strom všech organizačních jednotek, kam uživatel spadá
2. **org_info** - příznak vedoucí funkce, kód aktuální organizační jednotky a kód nadřízené organizační jednotky

    
### Vyhledání skupiny

KLíčovým slovem pro hledání skupiny je její název včetně zástupných znaků. Vrací seznam (list) slovníků (dictinary).

    ...
    group_list = DIRECTORY_FACTORY.get_group('*3')
    group_list = DIRECTORY_FACTORY.get_all_groups()

Pro případ potřeby lze tuto funkci zavolat jako "raw". Pak vrací surovou odpověď LDAP serveru. 
    
    user_list = DIRECTORY_FACTORY.get_group_raw('Jos*')

### Organizační struktura

Factory obsahuje funkcionalitu, která dokáže z LDAP dat extrahovat organizační strukturu. 
Organizační struktura je ve stromové formě. Uzly jsou propojeny oběma směry. 

    ...
    os = DIRECTORY_FACTORY.get_org_structure()

### Ošetření chyb

Pokud se nepodaří připojit k LDAP serveru, modul nahlásí chybu a příznak ready u DIRECTORY_FACTORY je nastaven na False

    DIRECTORY_FACTORY.ready


## Systémové proměnné

Nastavení factory je řízeno systémovými proměnnými

- **LDAP_ENABLE** - True/False (implicitně True): Vypne modul. Zabraňuje timeoutu při hledání LDAP serveru.   
- **LDAP_SERVER_URI** - ve formátu např `ldap://localhost:389`
- **LDAP_BIND_DN** - přihlašovací jméno k serveru
- **LDAP_BIND_PASSWORD** - heslo k přihlašovacímu jménu
- **LDAP_BASE_DN** - základní kontext. Např. `OU=eSML,DC=ad,DC=mzp,DC=cz`

Implicitní nastavení nebo nastavení přes systémové proměnné lze vždy přebít ruční operací **reset**

    DIRECTORY_FACTORY.reset(uri=<uri>, bind_dn=<name>, bind_password=<password>, base_dn=<context>, enabled=<enabled>)
