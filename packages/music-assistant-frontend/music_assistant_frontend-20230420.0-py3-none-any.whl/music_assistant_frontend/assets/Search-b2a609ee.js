import{s as q}from"./vue-virtual-scroller.esm-e4c9c0e9.js";/* empty css                             */import{d as A,b as H,G as J,r as u,c as k,z as I,y as O,A as Q,o as m,n as V,a as i,j as g,w as n,F as P,v as T,f as b,l as _,h as v,q as $,m as W,s as L,k as R,i as X,V as Y}from"./index-b2a054f2.js";import{_ as Z}from"./ListviewItem.vue_vue_type_style_index_0_lang-8c60dbc4.js";import{_ as z,a as ee}from"./MediaItemContextMenu.vue_vue_type_style_index_0_lang-8aa3f99e.js";import{V as te,a as ae,b as le}from"./VSelect-aaee1a18.js";import{V as se,a as re}from"./VRow-177b896c.js";import{V as oe}from"./VSpacer-454f4925.js";import{V as ie}from"./VTooltip-b4f86fd5.js";import{V as ue,l as ne}from"./VBtn-0977a48f.js";import{V as me}from"./VToolbar-6c594292.js";import"./utils-da036adc.js";import"./VCardText-db7c3153.js";import"./_plugin-vue_export-helper-d6dedbb2.js";import"./ProviderIcon.vue_vue_type_script_setup_true_lang-cdb7bdca.js";import"./VCard-abc5aa23.js";import"./forwardRefs-82423578.js";import"./VDivider-00712c8a.js";import"./VMenu-0c5e6553.js";import"./VLabel-f8a655b7.js";import"./VCheckboxBtn-3dd95301.js";import"./VDialog-37e53ec6.js";/* empty css              */const ve={style:{"margin-left":"15px","margin-right":"15px","margin-top":"20px","margin-bottom":"20px",padding:"0"}},de={key:2},fe={style:{"margin-left":"15px"}},Ue=A({__name:"Search",props:{initSearch:null},setup(N){const C=N,U=H(),{mobile:D}=J(),s=u("list"),y=u(0),r=u(""),d=u(!1),l=u(),w=u(!1),f=u(!1),p=u([]),x=u(),M=["topresult","artists","albums","tracks","playlists","radios"],E=k(()=>D.value?140:150),G=function(){s.value==="panel"?s.value="list":s.value="panel",localStorage.setItem(`viewMode.search.${o.value}`,s.value)},B=function(e){p.value=[e],f.value=!0},F=function(e){var t;["artist","album","playlist"].includes(e.media_type)||!((t=L.selectedPlayer)!=null&&t.available)?U.push({name:e.media_type,params:{itemId:e.item_id,provider:e.provider}}):L.selectedPlayer&&R.playMedia(e)};I(()=>r.value,()=>{clearTimeout(x.value),x.value=setTimeout(()=>{j()},200)});const K=function(e){return e<500?2:e<=500?3:e<=700?4:e<=1e3?5:e<=1200?6:e<=1500?7:e<=1700?8:e>1700?9:0},j=async function(){w.value=!0,localStorage.setItem("globalsearch",r.value),r.value?l.value=await R.search(r.value):l.value=void 0,w.value=!1},o=k(()=>M[y.value]),c=k(()=>{if(!l.value)return[];if(o.value=="artists")return l.value.artists;if(o.value=="albums")return l.value.albums;if(o.value=="tracks")return l.value.tracks;if(o.value=="playlists")return l.value.playlists;if(o.value=="radios")return l.value.radio;if(o.value=="topresult"){const e=[];for(const t of[l.value.tracks,l.value.artists,l.value.albums,l.value.playlists,l.value.radio]){const a=[];for(const h of t)a.includes(h.provider)||(e.push(h),a.push(h.provider))}return e}return[]});I(()=>o.value,e=>{if(e){const t=localStorage.getItem(`viewMode.search.${o.value}`);t?s.value=t:o.value=="artists"||o.value=="albums"?s.value="panel":s.value="list"}},{immediate:!0}),O(()=>{if(C.initSearch)r.value=C.initSearch;else{const e=localStorage.getItem("globalsearch");e&&e!=="null"&&(r.value=e)}});const S=function(e){f.value||(e.key==="a"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),p.value=c.value):!d.value&&e.key=="Backspace"?r.value=r.value.slice(0,-1):!d.value&&e.key.length==1&&(r.value+=e.key))};return document.addEventListener("keydown",S),Q(()=>{document.removeEventListener("keydown",S)}),(e,t)=>(m(),V("div",null,[i(te,{id:"searchInput",modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),clearable:"","prepend-inner-icon":"mdi-magnify",label:e.$t("type_to_search"),"hide-details":"",variant:"filled",onFocus:t[1]||(t[1]=a=>d.value=!0),onBlur:t[2]||(t[2]=a=>d.value=!1)},null,8,["modelValue","label"]),g("div",null,[i(ae,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=a=>y.value=a),column:"",style:{"margin-top":"15px","margin-left":"10px"}},{default:n(()=>[(m(),V(P,null,T(M,a=>i(le,{key:a,filter:"",outlined:""},{default:n(()=>[X($(e.$t(a)),1)]),_:2},1024)),64))]),_:1},8,["modelValue"]),i(z,{modelValue:f.value,"onUpdate:modelValue":t[4]||(t[4]=a=>f.value=a),items:p.value,onClear:t[5]||(t[5]=()=>{p.value=[]})},null,8,["modelValue","items"]),g("div",ve,[w.value?(m(),b(ne,{key:0,indeterminate:""})):_("",!0),s.value=="panel"?(m(),b(se,{key:1},{default:n(()=>[(m(!0),V(P,null,T(v(c),a=>(m(),b(re,{key:a.uri,class:Y(`col-${K(e.$vuetify.display.width)}`)},{default:n(()=>[i(ee,{item:a,size:v(E),"is-selected":!1,"show-checkboxes":!1,onMenu:B,onClick:F},null,8,["item","size"])]),_:2},1032,["class"]))),128))]),_:1})):_("",!0),s.value=="list"?(m(),V("div",de,[i(v(q),{items:v(c),"item-size":60,"key-field":"item_id","page-mode":""},{default:n(({item:a})=>[i(Z,{item:a,"show-track-number":!1,"show-duration":!0,"show-library":!1,"show-menu":!0,"show-providers":!0,"show-checkboxes":!1,"is-selected":!1,"show-details":!0,onMenu:B,onClick:F},null,8,["item"])]),_:1},8,["items"])])):_("",!0)]),i(me,{density:"compact",variant:"flat",color:"transparent",height:"45"},{default:n(()=>[g("span",fe,$(e.$t("items_total",[v(c).length])),1),i(oe),i(ie,{location:"bottom"},{activator:n(({props:a})=>[i(ue,W(a,{icon:s.value=="panel"?"mdi-view-list":"mdi-grid",variant:"plain",onClick:t[6]||(t[6]=h=>G())}),null,16,["icon"])]),default:n(()=>[g("span",null,$(e.$t("tooltip.toggle_view_mode")),1)]),_:1})]),_:1})])]))}});export{Ue as default};
