import{g as ne,a9 as Ie,B as se,t as Q,aa as Se,ab as $e,ac as Ee,a as i,ad as Le,ae as Ae,m as E,af as Te,u as Be,E as De,r as y,z as x,y as q,ag as Me,ah as Pe,o as f,n as $,N as U,l as V,j as L,q as k,H as ie,ai as xe,aj as Ne,d as Oe,k as H,b as Fe,$ as O,A as Z,w as c,f as A,h as z,s as F,F as ee,v as te,i as R,V as Re}from"./index-b2a054f2.js";import{s as qe}from"./vue-virtual-scroller.esm-e4c9c0e9.js";/* empty css                             */import{_ as je}from"./ListviewItem.vue_vue_type_style_index_0_lang-8c60dbc4.js";import{_ as Ke,i as Ue,a as He}from"./MediaItemContextMenu.vue_vue_type_style_index_0_lang-8aa3f99e.js";import{V as Ge}from"./VToolbar-6c594292.js";import{V as Xe}from"./VSelect-aaee1a18.js";import{V as Ye,a as We}from"./VRow-177b896c.js";import{V as ae}from"./VAlert-8fc0b4ef.js";import{o as re,e as ue,f as Je,h as Qe,j as ce,p as Ze,q as de,u as me,a as P,r as ze,m as et,s as tt,v as at,w as lt,x as ot,V as D,l as nt}from"./VBtn-0977a48f.js";import{m as st,b as it,f as rt,a as le,V as ut}from"./forwardRefs-82423578.js";import{V as M}from"./VTooltip-b4f86fd5.js";import{V as ct}from"./VSpacer-454f4925.js";import{m as dt,M as mt,V as vt,b as ft}from"./VCardText-db7c3153.js";import{a as pt}from"./VCard-abc5aa23.js";import{V as bt}from"./VMenu-0c5e6553.js";import{V as gt}from"./VDivider-00712c8a.js";const yt=ne()({name:"VBadge",inheritAttrs:!1,props:{bordered:Boolean,color:String,content:[Number,String],dot:Boolean,floating:Boolean,icon:Ie,inline:Boolean,label:{type:String,default:"$vuetify.badge"},max:[Number,String],modelValue:{type:Boolean,default:!0},offsetX:[Number,String],offsetY:[Number,String],textColor:String,...re({location:"top end"}),...ue(),...Je(),...se(),...dt({transition:"scale-rotate-transition"})},setup(e,m){const{backgroundColorClasses:n,backgroundColorStyles:r}=Qe(Q(e,"color")),{roundedClasses:C}=ce(e),{t:p}=Se(),{textColorClasses:s,textColorStyles:I}=Ze(Q(e,"textColor")),{themeClasses:T}=$e(),{locationStyles:_}=de(e,!0,b=>(e.floating?e.dot?2:4:e.dot?8:12)+(["top","bottom"].includes(b)?+(e.offsetY??0):["left","right"].includes(b)?+(e.offsetX??0):0));return me(()=>{const b=Number(e.content),o=!e.max||isNaN(b)?e.content:b<=+e.max?b:`${e.max}+`,[a,w]=Ee(m.attrs,["aria-atomic","aria-label","aria-live","role","title"]);return i(e.tag,E({class:["v-badge",{"v-badge--bordered":e.bordered,"v-badge--dot":e.dot,"v-badge--floating":e.floating,"v-badge--inline":e.inline}]},w),{default:()=>{var v,g;return[i("div",{class:"v-badge__wrapper"},[(g=(v=m.slots).default)==null?void 0:g.call(v),i(mt,{transition:e.transition},{default:()=>{var d,S;return[Le(i("span",E({class:["v-badge__badge",T.value,n.value,C.value,s.value],style:[r.value,I.value,e.inline?{}:_.value],"aria-atomic":"true","aria-label":p(e.label,b),"aria-live":"polite",role:"status"},a),[e.dot?void 0:m.slots.badge?(S=(d=m.slots).badge)==null?void 0:S.call(d):e.icon?i(P,{icon:e.icon},null):o]),[[Ae,e.modelValue]])]}})])]}})}),{}}});const ht=ne()({name:"VSnackbar",props:{multiLine:Boolean,timeout:{type:[Number,String],default:5e3},vertical:Boolean,...re({location:"bottom"}),...ze(),...ue(),...et(),...se(),...Te(st({transition:"v-snackbar-transition"}),["persistent","noClickAnimation","scrim","scrollStrategy"])},emits:{"update:modelValue":e=>!0},setup(e,m){let{slots:n}=m;const r=Be(e,"modelValue"),{locationStyles:C}=de(e),{positionClasses:p}=tt(e),{scopeId:s}=it(),{themeClasses:I}=De(e),{colorClasses:T,colorStyles:_,variantClasses:b}=at(e),{roundedClasses:o}=ce(e),a=y();x(r,v),x(()=>e.timeout,v),q(()=>{r.value&&v()});let w=-1;function v(){window.clearTimeout(w);const d=Number(e.timeout);!r.value||d===-1||(w=window.setTimeout(()=>{r.value=!1},d))}function g(){window.clearTimeout(w)}return me(()=>{const[d]=le.filterProps(e);return i(le,E({ref:a,class:["v-snackbar",{"v-snackbar--active":r.value,"v-snackbar--multi-line":e.multiLine&&!e.vertical,"v-snackbar--vertical":e.vertical},p.value]},d,{modelValue:r.value,"onUpdate:modelValue":S=>r.value=S,contentProps:E({class:["v-snackbar__wrapper",I.value,T.value,o.value,b.value],style:[C.value,_.value],onPointerenter:g,onPointerleave:v},d.contentProps),persistent:!0,noClickAnimation:!0,scrim:!1,scrollStrategy:"none",_disableGlobalStack:!0},s),{default:()=>[lt(!1,"v-snackbar"),n.default&&i("div",{class:"v-snackbar__content",role:"status","aria-live":"polite"},[n.default()]),n.actions&&i(ot,{defaults:{VBtn:{variant:"text",ripple:!1}}},{default:()=>[i("div",{class:"v-snackbar__actions"},[n.actions()])]})],activator:n.activator})}),rt({},a)}}),ve=(e,m)=>{const n=e.__vccOpts||e;for(const[r,C]of m)n[r]=C;return n},kt={},wt=e=>(xe("data-v-259be2b2"),e=e(),Ne(),e),Vt={class:"container"},Ct=wt(()=>L("div",{class:"spinner"},null,-1)),_t=[Ct];function It(e,m){return f(),$("div",Vt,_t)}const St=ve(kt,[["render",It],["__scopeId","data-v-259be2b2"],["__file","/home/oumoussa/side-projects/infinite/src/components/Spinner.vue"]]),$t=e=>({loading(){e.value="loading"},loaded(){e.value="loaded"},complete(){e.value="complete"},error(){e.value="error"}}),Et=(e,m,n)=>()=>{const r=n.parentEl||document.documentElement;n.prevHeight=r.scrollHeight,m.loading(),e("infinite",m)},Lt=(e,m)=>{const n=e.getBoundingClientRect();if(!m)return n.top>=0&&n.bottom<=window.innerHeight;const r=m.getBoundingClientRect();return n.top>=r.top&&n.bottom<=r.bottom},oe=e=>{e.parentEl=document.querySelector(e.target)||null;let m=`0px 0px ${e.distance}px 0px`;e.top&&(m=`${e.distance}px 0px 0px 0px`);const n=new IntersectionObserver(r=>{r[0].isIntersecting&&(e.firstload&&e.emit(),e.firstload=!0)},{root:e.parentEl,rootMargin:m});return n.observe(e.infiniteLoading.value),n},At={class:"state-error"},Tt={__name:"InfiniteLoading",props:{top:{type:Boolean,required:!1},target:{type:[String,Boolean],required:!1},distance:{type:Number,required:!1,default:0},identifier:{required:!1},firstload:{type:Boolean,required:!1,default:!0},slots:{type:Object,required:!1}},emits:["infinite"],setup(e,{emit:m}){const n=e;let r=null;const C=y(null),p=y("ready"),{top:s,firstload:I,target:T,distance:_}=n,{identifier:b}=Me(n),o={infiniteLoading:C,target:T,top:s,firstload:I,distance:_,prevHeight:0,parentEl:null};o.emit=Et(m,$t(p),o);const a=()=>x(p,async v=>{const g=o.parentEl||document.documentElement;await ie(),v=="loaded"&&s&&(g.scrollTop=g.scrollHeight-o.prevHeight),v=="loaded"&&Lt(C.value,o.parentEl)&&o.emit(),v=="complete"&&r.disconnect()}),w=()=>x(b,()=>{p.value="ready",r.disconnect(),r=oe(o)});return q(()=>{r=oe(o),a(),b&&w()}),Pe(()=>{r.disconnect()}),(v,g)=>(f(),$("div",{ref_key:"infiniteLoading",ref:C},[p.value=="loading"?U(v.$slots,"spinner",{key:0},()=>[i(St)],!0):V("v-if",!0),p.value=="complete"?U(v.$slots,"complete",{key:1},()=>{var d;return[L("span",null,k(((d=e.slots)==null?void 0:d.complete)||"No more results!"),1)]},!0):V("v-if",!0),p.value=="error"?U(v.$slots,"error",{key:2,retry:o.emit},()=>{var d;return[L("span",At,[L("span",null,k(((d=e.slots)==null?void 0:d.error)||"Oops something went wrong!"),1),L("button",{class:"retry",onClick:g[0]||(g[0]=(...S)=>o.emit&&o.emit(...S))}," retry ")])]},!0):V("v-if",!0)],512))}},Bt=ve(Tt,[["__scopeId","data-v-9d82030b"],["__file","/home/oumoussa/side-projects/infinite/src/components/InfiniteLoading.vue"]]);const Dt={key:0},Mt={key:0},Pt={key:1},xt={style:{"margin-left":"15px","margin-right":"15px","margin-top":"20px","margin-bottom":"20px",padding:"0"}},Nt={key:2},Ot={key:3},aa=function(e,m,n,r,C,p=!0){var _,b;let s=[];if(C){const o=C.toLowerCase();for(const a of e)(a.name.toLowerCase().includes(o)||"artist"in a&&((_=a.artist)!=null&&_.name.toLowerCase().includes(o))||"album"in a&&((b=a.album)!=null&&b.name.toLowerCase().includes(o))||"artists"in a&&a.artists&&a.artists[0].name.toLowerCase().includes(o))&&s.push(a)}else s=e;r=="sort_name"&&s.sort((o,a)=>(o.sort_name||o.name).localeCompare(a.sort_name||a.name)),r=="sort_album"&&s.sort((o,a)=>{var w,v;return(v=o.album)==null?void 0:v.name.localeCompare((w=a.album)==null?void 0:w.name)}),r=="sort_artist"&&s.sort((o,a)=>o.artists[0].name.localeCompare(a.artists[0].name)),r=="track_number"&&(s.sort((o,a)=>(o.track_number||0)-(a.track_number||0)),s.sort((o,a)=>(o.disc_number||0)-(a.disc_number||0))),r=="position"&&s.sort((o,a)=>(o.position||0)-(a.position||0)),r=="position DESC"&&s.sort((o,a)=>(a.position||0)-(o.position||0)),r=="year"&&s.sort((o,a)=>(o.year||0)-(a.year||0)),r=="timestamp_added DESC"&&s.sort((o,a)=>(a.timestamp_added||0)-(o.timestamp_added||0)),r=="duration"&&s.sort((o,a)=>(o.duration||0)-(a.duration||0)),r=="provider"&&s.sort((o,a)=>o.provider.localeCompare(a.provider)),p&&(s=s.filter(o=>o.in_library));const I=s.length,T=s.slice(m,m+n);return{items:T,count:T.length,limit:n,offset:m,total:I}},la=Oe({__name:"ItemsListing",props:{itemtype:null,sortKeys:{default:()=>["sort_name","timestamp_added DESC"]},showTrackNumber:{type:Boolean,default:!0},showProviders:{type:Boolean,default:Object.keys(H.providers).length>1},showAlbum:{type:Boolean,default:!0},showMenu:{type:Boolean,default:!0},showLibrary:{type:Boolean,default:!0},showDuration:{type:Boolean,default:!0},parentItem:{default:void 0},showAlbumArtistsOnlyFilter:{type:Boolean},albumArtistsOnlyFilter:{type:Boolean},updateAvailable:{type:Boolean},loadData:null},emits:["toggleAlbumArtistsOnly","refreshClicked"],setup(e,{emit:m}){const n=e,r=100,C=Fe(),p=y("list"),s=y(""),I=y("sort_name"),T=y(!1),_=y(!1),b=y(!1),o=y(0),a=y([]),w=y(),v=y(!1),g=y(!1),d=y([]),S=y(!1),fe=y(!1),N=y(!1),pe=function(){_.value?_.value=!1:(_.value=!0,ie(()=>{var t;(t=document.getElementById("searchInput"))==null||t.focus()}))},be=function(t){return t<500?2:t<=500?3:t<=700?4:t<=1e3?5:t<=1200?6:t<=1500?7:t<=1700?8:t>1700?9:8},ge=function(){p.value==="panel"?p.value="list":p.value="panel",localStorage.setItem(`viewMode.${n.itemtype}`,p.value)},ye=function(){g.value=!g.value;const t=g.value?"true":"false";localStorage.setItem(`libraryFilter.${n.itemtype}`,t),B(!0)},G=function(t){return d.value.includes(t)},X=function(t,u){if(u)d.value.includes(t)||d.value.push(t);else for(let l=0;l<d.value.length;l++)d.value[l]===t&&d.value.splice(l,1);F.blockGlobalPlayMenu=d.value.length>0},he=function(){d.value=[],N.value=!1,F.blockGlobalPlayMenu=!1},j=function(){d.value.length>0?S.value=!0:N.value=!N.value},ke=function(t){B(!0)},K=function(t){d.value=[t],S.value=!0},we=function(){B(!0),m("refreshClicked")},Y=function(t){var l;if(!Ue(t)){K(t);return}const u=n.itemtype.includes("versions").toString();["artist","album","playlist"].includes(t.media_type)||u=="true"||!((l=F.selectedPlayer)!=null&&l.available)?C.push({name:t.media_type,params:{itemId:t.item_id,provider:t.provider,forceProviderVersion:u}}):F.selectedPlayer&&H.playMedia(t)},Ve=function(t,u){t!==void 0&&(I.value=t),localStorage.setItem(`sortBy.${n.itemtype}`,I.value),B(!0)},Ce=function(t){if(a.value.length==0){t.loaded();return}if(w.value!==void 0&&o.value>=w.value){t.loaded();return}o.value+=r,B().then(()=>{t.loaded()})},_e=function(){localStorage.setItem("globalsearch",s.value),C.push({name:"search",params:{initSearch:s.value}})};x(()=>s.value,t=>{t&&(_.value=!0),B(!0)}),x(()=>n.updateAvailable,t=>{t&&a.value.length==0&&B(!0)});const B=async function(t=!1,u=r){t&&(o.value=0,fe.value=!1),v.value=!0;const l=await n.loadData(o.value,u,I.value,s.value||"",g.value);o.value?a.value.push(...l.items):a.value=l.items,w.value=l.total,v.value=!1;let h=`search.${n.itemtype}`;n.parentItem&&(h+=n.parentItem.item_id),localStorage.setItem(h,s.value)};q(()=>{const t=localStorage.getItem(`viewMode.${n.itemtype}`);t&&t!=="null"?p.value=t:n.itemtype=="artists"||n.itemtype=="albums"?p.value="panel":p.value="list";const u=localStorage.getItem(`sortBy.${n.itemtype}`);if(u&&u!=="null"?I.value=u:I.value=n.sortKeys[0],n.showLibrary!==!1){const J=localStorage.getItem(`libraryFilter.${n.itemtype}`);J&&J=="true"&&(g.value=!0)}let l=`search.${n.itemtype}`;n.parentItem&&(l+=n.parentItem.item_id);const h=localStorage.getItem(l);h&&h!=="null"&&(console.log("savedSearch",h),s.value=h),B(!0)}),q(()=>{const t=H.subscribe_multi([O.MEDIA_ITEM_ADDED,O.MEDIA_ITEM_UPDATED,O.MEDIA_ITEM_DELETED],u=>{if(u.event==O.MEDIA_ITEM_DELETED)a.value=a.value.filter(l=>l.uri!=u.object_id);else if(u.event==O.MEDIA_ITEM_UPDATED){const l=u.data;a.value=a.value.map(h=>h.uri==l.uri?l:h)}});Z(t)});const W=function(t){S.value||(t.key==="a"&&(t.ctrlKey||t.metaKey)?(t.preventDefault(),d.value=a.value):!b.value&&t.key=="Backspace"?s.value=s.value.slice(0,-1):!b.value&&t.key.length==1&&(s.value+=t.key,_.value=!0))};return document.addEventListener("keydown",W),Z(()=>{document.removeEventListener("keydown",W)}),(t,u)=>(f(),$("section",null,[i(Ge,{density:"compact",variant:"flat",color:"transparent"},{default:c(()=>[i(M,{location:"bottom"},{activator:c(({props:l})=>[i(D,E(l,{icon:d.value.length>0?"mdi-checkbox-multiple-outline":"mdi-checkbox-multiple-blank-outline",variant:"plain",onClick:j}),null,16,["icon"]),t.$vuetify.display.mobile?V("",!0):(f(),$("span",Dt,[!d.value.length&&w.value?(f(),$("span",{key:0,style:{cursor:"pointer"},onClick:j},k(t.$t("items_total",[w.value])),1)):d.value.length?(f(),$("span",{key:1,style:{cursor:"pointer"},onClick:j},k(t.$t("items_selected",[d.value.length])),1)):V("",!0)]))]),default:c(()=>[L("span",null,k(t.$t("tooltip.select_items")),1)]),_:1}),i(ct),i(M,{location:"bottom","close-on-content-click":""},{activator:c(({props:l})=>[e.showLibrary!==!1?(f(),A(D,E({key:0},l,{icon:"",variant:"plain",onClick:ye}),{default:c(()=>[i(P,{icon:g.value?"mdi-heart":"mdi-heart-outline"},null,8,["icon"])]),_:2},1040)):V("",!0)]),default:c(()=>[L("span",null,k(t.$t("tooltip.filter_library")),1)]),_:1}),e.showAlbumArtistsOnlyFilter?(f(),A(M,{key:0,location:"bottom"},{activator:c(({props:l})=>[i(D,E(l,{icon:"",variant:"plain",onClick:u[0]||(u[0]=h=>{m("toggleAlbumArtistsOnly"),B(!0)})}),{default:c(()=>[i(P,{icon:e.albumArtistsOnlyFilter?"mdi-account-music":"mdi-account-music-outline"},null,8,["icon"])]),_:2},1040)]),default:c(()=>[L("span",null,k(t.$t("tooltip.album_artist_filter")),1)]),_:1})):V("",!0),i(M,{location:"bottom"},{activator:c(({props:l})=>[i(D,E(l,{icon:"",variant:"plain",onClick:u[1]||(u[1]=h=>we())}),{default:c(()=>[i(yt,{"model-value":e.updateAvailable,color:"error",dot:""},{default:c(()=>[i(P,{icon:"mdi-refresh"})]),_:1},8,["model-value"])]),_:2},1040)]),default:c(()=>[e.updateAvailable?(f(),$("span",Mt,k(t.$t("tooltip.refresh_new_content")),1)):(f(),$("span",Pt,k(t.$t("tooltip.refresh")),1))]),_:1}),e.sortKeys.length>1?(f(),A(bt,{key:1,modelValue:T.value,"onUpdate:modelValue":u[2]||(u[2]=l=>T.value=l),location:"bottom end","close-on-content-click":!0},{activator:c(({props:l})=>[i(M,{location:"bottom"},{activator:c(({props:h})=>[i(D,E({icon:""},n,{variant:"plain"}),{default:c(()=>[i(P,E(E(l,h),{icon:"mdi-sort"}),null,16)]),_:2},1040)]),default:c(()=>[L("span",null,k(t.$t("tooltip.sort_options")),1)]),_:2},1024)]),default:c(()=>[i(pt,null,{default:c(()=>[i(ut,null,{default:c(()=>[(f(!0),$(ee,null,te(e.sortKeys,l=>(f(),$("div",{key:l},[i(vt,{onClick:h=>Ve(l)},{append:c(()=>[I.value==l?(f(),A(P,{key:0,icon:"mdi-check"})):V("",!0)]),default:c(()=>[i(ft,null,{default:c(()=>[R(k(t.$t("sort."+l)),1)]),_:2},1024)]),_:2},1032,["onClick"]),i(gt)]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])):V("",!0),i(M,{location:"bottom"},{activator:c(({props:l})=>[i(D,E(l,{icon:"",variant:"plain",onClick:u[3]||(u[3]=h=>pe())}),{default:c(()=>[i(P,{icon:"mdi-magnify"})]),_:2},1040)]),default:c(()=>[L("span",null,k(t.$t("tooltip.search")),1)]),_:1}),i(M,{location:"bottom"},{activator:c(({props:l})=>[i(D,E(l,{icon:p.value=="panel"?"mdi-view-list":"mdi-grid",variant:"plain",onClick:u[4]||(u[4]=h=>ge())}),null,16,["icon"])]),default:c(()=>[L("span",null,k(t.$t("tooltip.toggle_view_mode")),1)]),_:1})]),_:1}),i(Ke,{modelValue:S.value,"onUpdate:modelValue":u[5]||(u[5]=l=>S.value=l),items:d.value,"parent-item":e.parentItem,onClear:he,onDelete:ke},null,8,["modelValue","items","parent-item"]),_.value?(f(),A(Xe,{key:0,id:"searchInput",modelValue:s.value,"onUpdate:modelValue":u[6]||(u[6]=l=>s.value=l),clearable:"","prepend-inner-icon":"mdi-magnify",label:t.$t("search"),"hide-details":"",variant:"filled",style:{width:"auto","margin-left":"15px","margin-right":"15px","margin-top":"10px"},onFocus:u[7]||(u[7]=l=>b.value=!0),onBlur:u[8]||(u[8]=l=>b.value=!1)},null,8,["modelValue","label"])):V("",!0),L("div",xt,[v.value?(f(),A(nt,{key:0,indeterminate:""})):V("",!0),p.value=="panel"?(f(),A(Ye,{key:1},{default:c(()=>[(f(!0),$(ee,null,te(a.value,l=>(f(),A(We,{key:l.uri,class:Re(`col-${be(t.$vuetify.display.width)}`)},{default:c(()=>[i(He,{item:l,"is-selected":G(l),"show-checkboxes":N.value,onSelect:X,onMenu:K,onClick:Y},null,8,["item","is-selected","show-checkboxes"])]),_:2},1032,["class"]))),128))]),_:1})):V("",!0),p.value=="list"?(f(),$("div",Nt,[i(z(qe),{items:a.value,"item-size":60,"key-field":"uri","page-mode":""},{default:c(({item:l})=>[(f(),A(je,{key:l.uri,item:l,"show-track-number":e.showTrackNumber,"show-duration":e.showDuration,"show-library":e.showLibrary!==!1&&!g.value,"show-menu":e.showMenu,"show-providers":e.showProviders,"show-album":e.showAlbum,"show-checkboxes":N.value,"is-selected":G(l),"show-details":e.itemtype.includes("versions"),"parent-item":e.parentItem,onSelect:X,onMenu:K,onClick:Y},null,8,["item","show-track-number","show-duration","show-library","show-menu","show-providers","show-album","show-checkboxes","is-selected","show-details","parent-item"]))]),_:1},8,["items"])])):V("",!0),i(z(Bt),{onInfinite:Ce}),!v.value&&a.value.length==0?(f(),$("div",Ot,[!v.value&&a.value.length==0&&(s.value||g.value)?(f(),A(ae,{key:0,density:"compact",variant:"outlined",title:t.$t("no_content_filter")},{default:c(()=>[s.value?(f(),A(D,{key:0,style:{"margin-top":"15px"},onClick:_e},{default:c(()=>[R(k(t.$t("try_global_search")),1)]),_:1})):V("",!0)]),_:1},8,["title"])):!v.value&&a.value.length==0?(f(),A(ae,{key:1,density:"compact",variant:"outlined"},{default:c(()=>[R(k(t.$t("no_content")),1)]),_:1})):V("",!0)])):V("",!0),i(ht,{"model-value":d.value.length>1,timeout:-1,style:{"margin-bottom":"120px"}},{actions:c(()=>[i(D,{color:"primary",variant:"text",onClick:u[9]||(u[9]=l=>S.value=!0)},{default:c(()=>[R(k(t.$t("actions")),1)]),_:1})]),default:c(()=>[L("span",null,k(t.$t("items_selected",[d.value.length])),1)]),_:1},8,["model-value"])])]))}});export{la as _,aa as f};
